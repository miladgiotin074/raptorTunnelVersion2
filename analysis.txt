تجزیه و تحلیل دقیق اسکریپت bash.txt

این اسکریپت bash برای مدیریت تونل VXLAN بین دو سرور (ایران و خارج) و تنظیم Xray برای پروکسی SOCKS5 طراحی شده است. در ادامه، به صورت بخش به بخش آن را تحلیل می‌کنم:

1. **متغیرهای اولیه:**
   - VXLAN_IF="vxlan88": نام اینترفیس VXLAN.
   - VXLAN_ID=88: شناسه VXLAN.
   - VXLAN_NET="10.200.200.0/24": شبکه VXLAN.
   - VXLAN_IP_IRAN="10.200.200.1": IP سرور ایران در VXLAN.
   - VXLAN_IP_REMOTE="10.200.200.2": IP سرور خارج در VXLAN.
   - XRAY_CONFIG_PATH="/usr/local/etc/xray/config.json": مسیر فایل کانفیگ Xray.
   - OUT_DEV: اینترفیس خروجی را با استفاده از ip route تشخیص می‌دهد.

2. **تابع menu():**
   - یک منو ساده نمایش می‌دهد برای انتخاب گزینه‌ها: ریست تمام تنظیمات، تنظیم سرور ایران، تنظیم سرور خارج.

3. **تابع reset_all():**
   - Xray را متوقف می‌کند.
   - اینترفیس VXLAN را حذف می‌کند.
   - قوانین iptables را پاک می‌کند.
   - IP forwarding را غیرفعال می‌کند.
   - پیام اتمام ریست را نمایش می‌دهد.

4. **تابع setup_iran():**
   - ورودی‌ها: IP عمومی ایران، IP عمومی خارج، پورت UDP VXLAN (پیش‌فرض 4789)، پورت Xray (پیش‌فرض 1080).
   - VXLAN را تنظیم می‌کند: ایجاد اینترفیس، افزودن IP، فعال کردن آن.
   - قوانین iptables برای پذیرش ترافیک UDP از IP خارج.
   - فعال کردن IP forwarding.
   - ایجاد فایل کانفیگ Xray برای inbound SOCKS5 روی 0.0.0.0 و outbound به IP VXLAN خارج.
   - ری‌استارت Xray و نمایش وضعیت.

5. **تابع setup_remote():**
   - ورودی‌ها: IP عمومی خارج، IP عمومی ایران، پورت UDP VXLAN (پیش‌فرض 4789)، پورت Xray (پیش‌فرض 1090).
   - VXLAN را تنظیم می‌کند: ایجاد اینترفیس، افزودن IP، فعال کردن آن.
   - قوانین iptables برای پذیرش ترافیک UDP از IP ایران و MASQUERADE برای شبکه VXLAN.
   - فعال کردن IP forwarding.
   - ایجاد فایل کانفیگ Xray برای inbound SOCKS5 روی IP VXLAN خارج و outbound freedom.
   - ری‌استارت Xray و نمایش وضعیت.

این اسکریپت ساده اما کارآمد است و فرض می‌کند Xray از قبل نصب شده باشد. برای داشبورد، می‌توان این منطق را به یک وب اپ ترجمه کرد.